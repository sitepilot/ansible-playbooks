# {{ ansible_managed }}
virtualHost {{ site }} {
    user                      {{ user }}
    group                     {{ user }}
    listeners                 http, https

    vhRoot                    /opt/{{ admin }}/users/{{ user }}/sites/{{ site }}
    docRoot                   $VH_ROOT/public

    allowSymbolLink           1
    enableScript              1
    restrained                1
    setUIDMode                2

    vhDomain                  {{ domain }}
    vhAliases                 {{ domains|join(', ') }}

    enableGzip                1
    enableIpGeo               1
    
    errorlog /opt/{{ admin }}/users/{{ user }}/sites/{{ site }}/logs/error.log {
        useServer               0
        logLevel                NOTICE
        rollingSize             0
    }

    accesslog /opt/{{ admin }}/users/{{ user }}/sites/{{ site }}/logs/access.log {
        useServer               0
        logFormat               %a %l %u %t "%r" %>s %O "%{Referer}i" "%{User-Agent}i"
        logHeaders              5
        rollingSize             0
    }

    scripthandler  {
        add                     lsapi:lsphp{{ php_version | default('74') }} inc
        add                     lsapi:lsphp{{ php_version | default('74') }} php
        add                     lsapi:lsphp{{ php_version | default('74') }} phtml
        add                     lsapi:lsphp{{ php_version | default('74') }} php74
    }

    phpIniOverride  {
        php_admin_value mail.log "$VH_ROOT/logs/php-mail.log"
        php_admin_value error_log "$VH_ROOT/logs/php-error.log"
    }

    rewrite  {
        enable                  1
        autoLoadHtaccess        1
    }
}
